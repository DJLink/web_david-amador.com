<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>C# foreach VS for loop | David Amador</title>
<meta name=keywords content="csharp"><meta name=description content="When I started using C#, mainly because of XNA one of the things I got used to write is foreach loops instead of for, seemed easier and it’s a much cleaner code. Doing almost the same thing as a for loop I never really bother to see the differences, almost everyone in their XNA examples used it instead.
Today I decided to see the differences between them:
FOR
<pre lang=&#34;csharp&#34;>int[] values = new int[1]; int total = 0; for(int i = 0; i < values."><meta name=author content="David Amador"><link rel=canonical href=https://www.david-amador.com/2009/12/csharp-foreach-vs-for-loop/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://www.david-amador.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://www.david-amador.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://www.david-amador.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://www.david-amador.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://www.david-amador.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="C# foreach VS for loop"><meta property="og:description" content="When I started using C#, mainly because of XNA one of the things I got used to write is foreach loops instead of for, seemed easier and it’s a much cleaner code. Doing almost the same thing as a for loop I never really bother to see the differences, almost everyone in their XNA examples used it instead.
Today I decided to see the differences between them:
FOR
<pre lang=&#34;csharp&#34;>int[] values = new int[1]; int total = 0; for(int i = 0; i < values."><meta property="og:type" content="article"><meta property="og:url" content="https://www.david-amador.com/2009/12/csharp-foreach-vs-for-loop/"><meta property="og:image" content="https://www.david-amador.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2009-12-12T18:38:33+00:00"><meta property="article:modified_time" content="2009-12-12T18:38:33+00:00"><meta property="og:site_name" content="David Amador"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.david-amador.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="C# foreach VS for loop"><meta name=twitter:description content="When I started using C#, mainly because of XNA one of the things I got used to write is foreach loops instead of for, seemed easier and it’s a much cleaner code. Doing almost the same thing as a for loop I never really bother to see the differences, almost everyone in their XNA examples used it instead.
Today I decided to see the differences between them:
FOR
<pre lang=&#34;csharp&#34;>int[] values = new int[1]; int total = 0; for(int i = 0; i < values."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.david-amador.com/posts/"},{"@type":"ListItem","position":2,"name":"C# foreach VS for loop","item":"https://www.david-amador.com/2009/12/csharp-foreach-vs-for-loop/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"C# foreach VS for loop","name":"C# foreach VS for loop","description":"When I started using C#, mainly because of XNA one of the things I got used to write is foreach loops instead of for, seemed easier and it’s a much cleaner code. Doing almost the same thing as a for loop I never really bother to see the differences, almost everyone in their XNA examples used it instead.\nToday I decided to see the differences between them:\nFOR\n\u0026lt;pre lang=\u0026#34;csharp\u0026#34;\u0026gt;int[] values = new int[1]; int total = 0; for(int i = 0; i \u0026lt; values.","keywords":["csharp"],"articleBody":"When I started using C#, mainly because of XNA one of the things I got used to write is foreach loops instead of for, seemed easier and it’s a much cleaner code. Doing almost the same thing as a for loop I never really bother to see the differences, almost everyone in their XNA examples used it instead.\nToday I decided to see the differences between them:\nFOR\nint[] values = new int[1]; int total = 0; for(int i = 0; i \u003c values.Length; i++) { total += values[i]; } FOREACH\nint[] values = new int[1]; int total = 0; foreach(int i in values ) { total += i; } In variable declaration, foreach has five variable declarations (three Int32 integers and two arrays of Int32) while for has only three (two Int32 integers and one Int32 array). When it goes to loop through, foreach copies the current array to a new one for the operation. While for doesn’t care of that part.\nAfter the compiler interpretation to Assembly we get this:\nFOR\ncmp dword ptr [eax+4],0 i jle 0000000F mov ecx,dword ptr [eax+edx*4+8] inc edx cmp esi,dword ptr [eax+4] jl FFFFFFF8 FOREACH\ncmp esi,dword ptr [ebx+4] i jl FFFFFFE3 cmp esi,dword ptr [ebx+4] jb 00000009 mov eax,dword ptr [ebx+esi*4+8] mov dword ptr [ebp-0Ch],eax mov eax,dword ptr [ebp-0Ch] add dword ptr [ebp-8],eax inc esi cmp esi,dword ptr [ebx+4] jl FFFFFFE3 As you can see we end up with much more instructions.\nSome simple tests gives these results:\nUsing Objects Using Integers FOR FOREACH ArrayList – 2147483 items 88.6 115.9 generic collection – 2147483 items 84.4 87.1 Array – 2147483 items 48.1 49.8 *Time is in milliseconds.\nSo what I’ve done after this was to replace some heavy foreach code on my engine by for loops. I guess small things can be neglected but it’s always nice to know where bottlenecks may happen.\n","wordCount":"316","inLanguage":"en","datePublished":"2009-12-12T18:38:33Z","dateModified":"2009-12-12T18:38:33Z","author":{"@type":"Person","name":"David Amador"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.david-amador.com/2009/12/csharp-foreach-vs-for-loop/"},"publisher":{"@type":"Organization","name":"David Amador","logo":{"@type":"ImageObject","url":"https://www.david-amador.com/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.david-amador.com accesskey=h title="David Amador (Alt + H)"><img src=https://www.david-amador.com/apple-touch-icon.png alt aria-label=logo height=35>David Amador</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.david-amador.com/ title=Blog><span>Blog</span></a></li><li><a href=https://www.david-amador.com/games/ title=Games><span>Games</span></a></li><li><a href=https://www.david-amador.com/portfolio/ title=Portfolio><span>Portfolio</span></a></li><li><a href=https://www.david-amador.com/about/ title="About Me"><span>About Me</span></a></li><li><a href=https://www.david-amador.com/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://www.david-amador.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.david-amador.com>Home</a>&nbsp;»&nbsp;<a href=https://www.david-amador.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">C# foreach VS for loop</h1><div class=post-meta><span title='2009-12-12 18:38:33 +0000 UTC'>December 12, 2009</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;316 words&nbsp;·&nbsp;David Amador&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/2009-12-12-csharp-foreach-vs-for-loop.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>When I started using C#, mainly because of XNA one of the things I got used to write is foreach loops instead of for, seemed easier and it’s a much cleaner code. Doing almost the same thing as a for loop I never really bother to see the differences, almost everyone in their XNA examples used it instead.</p><p>Today I decided to see the differences between them:</p><p>FOR</p><pre tabindex=0><code>&lt;pre lang=&#34;csharp&#34;&gt;int[] values = new int[1];
int total = 0;
for(int i = 0; i &lt; values.Length; i++)
{
    total += values[i];
}
</code></pre><p>FOREACH</p><pre tabindex=0><code>&lt;pre lang=&#34;csharp&#34;&gt;int[] values = new int[1];
int total = 0;
foreach(int i in values )
{
    total += i;
}
</code></pre><blockquote><p>In variable declaration, foreach has five variable declarations (three Int32 integers and two arrays of Int32) while for has only three (two Int32 integers and one Int32 array). When it goes to loop through, foreach copies the current array to a new one for the operation. While for doesn’t care of that part.</p></blockquote><p>After the compiler interpretation to Assembly we get this:</p><p>FOR</p><pre tabindex=0><code>&lt;pre lang=&#34;csharp&#34;&gt;cmp     dword ptr [eax+4],0           i
jle     0000000F
mov     ecx,dword ptr [eax+edx*4+8]
inc     edx
cmp     esi,dword ptr [eax+4]
jl      FFFFFFF8
</code></pre><p>FOREACH</p><pre tabindex=0><code>&lt;pre lang=&#34;csharp&#34;&gt;cmp     esi,dword ptr [ebx+4]          i
jl      FFFFFFE3
cmp     esi,dword ptr [ebx+4]
jb      00000009
mov     eax,dword ptr [ebx+esi*4+8]
mov     dword ptr [ebp-0Ch],eax
mov     eax,dword ptr [ebp-0Ch]
add     dword ptr [ebp-8],eax
inc     esi
cmp     esi,dword ptr [ebx+4]
jl      FFFFFFE3
</code></pre><p>As you can see we end up with much more instructions.<br>Some simple tests gives these results:</p><table><thead><tr><th></th><th style=text-align:center>Using Objects</th><th style=text-align:center>Using Integers</th></tr></thead><tbody><tr><td></td><td style=text-align:center>FOR</td><td style=text-align:center>FOREACH</td></tr><tr><td>ArrayList – 2147483 items</td><td style=text-align:center>88.6</td><td style=text-align:center>115.9</td></tr><tr><td>generic collection – 2147483 items</td><td style=text-align:center>84.4</td><td style=text-align:center>87.1</td></tr><tr><td>Array – 2147483 items</td><td style=text-align:center>48.1</td><td style=text-align:center>49.8</td></tr></tbody></table><p>*Time is in milliseconds.</p><p>So what I’ve done after this was to replace some heavy foreach code on my engine by for loops. I guess small things can be neglected but it’s always nice to know where bottlenecks may happen.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.david-amador.com/tags/csharp/>csharp</a></li></ul><nav class=paginav><a class=prev href=https://www.david-amador.com/2009/12/updates-about-different-pixel-and-sapphire/><span class=title>« Prev</span><br><span>Updates about Different Pixel and Sapphire</span>
</a><a class=next href=https://www.david-amador.com/2009/12/munchies-for-design/><span class=title>Next »</span><br><span>munchies for Design</span></a></nav></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//upfallstudios.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.david-amador.com>David Amador</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>